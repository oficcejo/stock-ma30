---
name: 30周均线交易系统
overview: 基于史丹·温斯坦《一条均线定乾坤》的阶段分析法，构建一套可实操的交易系统，包含30周均线趋势判断、进出场信号、钉钉/飞书webhook提醒、OpenAI大模型分析功能。
design:
  architecture:
    framework: react
    component: shadcn
  styleKeywords:
    - Dark Mode
    - FinTech
    - Glassmorphism
    - Data Visualization
    - Professional
  fontSystem:
    fontFamily: Inter
    heading:
      size: 24px
      weight: 600
    subheading:
      size: 18px
      weight: 500
    body:
      size: 14px
      weight: 400
  colorSystem:
    primary:
      - "#3B82F6"
      - "#10B981"
      - "#F59E0B"
      - "#EF4444"
    background:
      - "#0F172A"
      - "#1E293B"
      - "#334155"
    text:
      - "#F8FAFC"
      - "#94A3B8"
    functional:
      - "#22C55E"
      - "#EF4444"
      - "#EAB308"
      - "#3B82F6"
todos:
  - id: setup-project
    content: 初始化Python项目结构，创建requirements.txt和配置文件
    status: completed
  - id: data-collector
    content: 实现股票数据获取模块（akshare数据源）
    status: completed
    dependencies:
      - setup-project
  - id: phase-analyzer
    content: 开发30周均线阶段分析引擎
    status: completed
    dependencies:
      - data-collector
  - id: signal-generator
    content: 实现买入/卖出信号生成器
    status: completed
    dependencies:
      - phase-analyzer
  - id: risk-manager
    content: 开发风险管理模块（止损、仓位计算）
    status: completed
    dependencies:
      - signal-generator
  - id: notifier-service
    content: 实现钉钉/飞书webhook推送服务
    status: completed
    dependencies:
      - setup-project
  - id: ai-analyzer
    content: 集成OpenAI兼容大模型分析接口
    status: completed
    dependencies:
      - setup-project
  - id: task-scheduler
    content: 开发定时任务调度器，整合完整交易流程
    status: completed
    dependencies:
      - signal-generator
      - notifier-service
      - ai-analyzer
  - id: web-dashboard
    content: 使用[skill:web-developer]构建交易监控管理后台
    status: completed
    dependencies:
      - task-scheduler
  - id: test-deploy
    content: 系统测试和部署配置
    status: completed
    dependencies:
      - web-dashboard
---

## 产品概述

基于史丹·温斯坦《一条均线定乾坤》构建的可实操股票交易系统，通过30周均线阶段分析法实现自动化交易信号检测与提醒。

## 核心功能

- **阶段分析引擎**：自动识别股票四个阶段（底部/上升/顶部/下降），基于30周均线和成交量判断
- **买入信号检测**：股价放量突破第一阶段底部区间、30周均线向上、成交量放大2倍以上
- **卖出信号检测**：30周均线走平/向下、股价跌破均线且无法站回、成交量异常放大
- **风险管理模块**：止损位设置、仓位控制（单笔亏损不超过总资金2-3%）、金字塔加仓法
- **智能提醒系统**：支持钉钉/飞书webhook推送交易信号提醒
- **AI分析集成**：调用OpenAI兼容大模型进行市场分析和交易建议
- **多维度筛选**：大盘趋势、行业板块、相对强度排名综合判断

## 技术栈选择

- **后端框架**: Python + FastAPI（高性能异步API，适合实时数据处理和webhook推送）
- **数据处理**: pandas, numpy（股票数据计算和指标分析）
- **数据获取**: akshare（免费A股数据源）或 yfinance
- **定时任务**: APScheduler（每周定时扫描股票池）
- **AI集成**: openai 库（支持OpenAI兼容接口）
- **通知推送**: 钉钉/飞书 webhook HTTP调用
- **数据存储**: SQLite（轻量级，适合单机部署）或 PostgreSQL

## 技术架构

### 系统架构

采用分层架构设计：

- **数据层**: 股票行情数据获取与存储
- **分析层**: 阶段分析引擎、技术指标计算
- **决策层**: 买入/卖出信号判断、风险管理
- **推送层**: Webhook通知、AI分析报告生成

### 核心模块

1. **DataCollector**: 股票数据获取与缓存
2. **PhaseAnalyzer**: 30周均线阶段分析引擎
3. **SignalGenerator**: 交易信号生成器（买入/卖出）
4. **RiskManager**: 风险管理（止损、仓位计算）
5. **Notifier**: 钉钉/飞书webhook推送
6. **AIAnalyzer**: OpenAI大模型分析接口

### 数据流

定时任务触发 → 获取股票数据 → 计算30周均线 → 阶段分析 → 信号检测 → AI分析 → Webhook推送

## 目录结构

```
d:/www/stock/30zhouxian/
├── config/
│   └── settings.py          # [NEW] 配置文件（钉钉/飞书webhook、OpenAI API key等）
├── core/
│   ├── __init__.py
│   ├── data_collector.py    # [NEW] 股票数据获取模块
│   ├── phase_analyzer.py    # [NEW] 30周均线阶段分析引擎
│   ├── signal_generator.py  # [NEW] 交易信号生成器
│   └── risk_manager.py      # [NEW] 风险管理模块
├── services/
│   ├── __init__.py
│   ├── notifier.py          # [NEW] 钉钉/飞书webhook推送服务
│   └── ai_analyzer.py       # [NEW] OpenAI大模型分析服务
├── scheduler/
│   └── task_scheduler.py    # [NEW] 定时任务调度器
├── models/
│   └── schemas.py           # [NEW] 数据模型定义
├── main.py                  # [NEW] 应用入口
├── requirements.txt         # [NEW] Python依赖
└── 一根均线定乾坤.txt       # [EXIST] 原始书籍内容
```

## 关键代码结构

```python
# 阶段定义枚举
class StockPhase(Enum):
    PHASE_1_BOTTOM = 1      # 第一阶段：底部横盘
    PHASE_2_RISING = 2       # 第二阶段：上升趋势
    PHASE_3_TOP = 3          # 第三阶段：顶部横盘
    PHASE_4_FALLING = 4      # 第四阶段：下降趋势

# 交易信号
class TradeSignal(BaseModel):
    stock_code: str
    signal_type: Literal["BUY", "SELL", "HOLD"]
    phase: StockPhase
    current_price: float
    ma30_week: float
    volume_ratio: float      # 成交量比率
    reason: str              # 信号原因
    timestamp: datetime

# 阶段分析器接口
class PhaseAnalyzer:
    def analyze(self, df: pd.DataFrame) -> StockPhase: ...
    def detect_breakout(self, df: pd.DataFrame) -> bool: ...
    def calculate_ma30(self, df: pd.DataFrame) -> pd.Series: ...
```

## 设计风格

采用现代金融科技风格的Dashboard设计，强调数据可视化和专业感。使用深色主题配合渐变强调色，营造专业交易平台的氛围。

## 页面规划

1. **监控面板页**: 实时显示股票池状态、当前阶段分布、最新交易信号
2. **信号历史页**: 展示历史买入/卖出信号列表，支持筛选和搜索
3. **股票详情页**: 单只股票的K线图、30周均线、阶段分析可视化
4. **配置管理页**: webhook设置、AI接口配置、风险管理参数
5. **AI分析页**: 大模型分析报告展示和查询历史

## 区块设计

- **顶部导航栏**: 系统Logo、导航菜单、实时状态指示器
- **数据卡片区**: 关键指标展示（持仓数量、今日信号、胜率统计）
- **图表可视化区**: 股票K线图叠加30周均线、阶段颜色标注
- **信号列表区**: 交易信号表格，带买入/卖出颜色标识
- **底部信息栏**: 系统版本、数据更新时间、配置快捷入口

## Agent Extensions

### Skill

- **web-developer**: 用于构建交易系统的Web管理界面，提供股票池管理、信号查看、配置设置等功能
- Purpose: 创建基于React + Tailwind CSS的交易系统管理后台
- Expected outcome: 提供可视化的股票监控面板和信号历史记录页面